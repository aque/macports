# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           python 1.0
PortGroup           app 1.0

name                chirp
version             0.4.1
categories-append   comms
platforms           darwin
license             GPL-2
maintainers         gmail.com:allan.que openmaintainer
description         open-source tool for programming your amateur radio
long_description    ${name} is a free, open-source tool for programming your amateur radio. \
                    It supports a large number of manufacturers and models, as well as provides \
                    a way to interface with multiple data sources and formats. This is the GTK \
                    version. The native Mac app can be downloaded from the web site.

homepage            http://chirp.danplanet.com/

master_sites        http://chirp.danplanet.com/download/${version}
distfiles           ${name}-${version}${extract.suffix}

conflicts           ${name}-devel

checksums           rmd160  5cbd3aefeba9e4feabfbef0952aa63837dd29c02 \
                    sha256  8c9d652dc89dbab9e2a1a75c07aa7179ce403de078a4d02814365f89e183319e

python.default_version  27
app.executable      chirpw
app.icon            share/chirp.png

depends_lib-append  port:py${python.version}-serial \
                    port:py${python.version}-libxml2 \
                    port:py${python.version}-pygtk

subport ${name}-devel {
    version         20160703

    master_sites    http://trac.chirp.danplanet.com/chirp_daily/LATEST/
    distname        ${name}-daily-${version}
    distfiles       ${distname}${extract.suffix}

    conflicts       ${name}

    checksums       rmd160  2314cf3dbc05dae87703c34fce672665dd42f8ea \
                    sha256  a127f311bf73aa152b2287d005fae1b0e3190cddb1de77283ca4caece959a68d


    livecheck.regex "${name}-daily-(\\d+)"
}

patch {
    # build the GTK version instead
    reinplace "s|= \"darwin\"|= \"xdarwinx\"|" ${worksrcpath}/setup.py

    # set correct path to icon file
    if {${name} eq ${subport}} {
        set mainapp ${worksrcpath}/chirpui/mainapp.py
    } else {
        set mainapp ${worksrcpath}/chirp/ui/mainapp.py
    }
    reinplace "s|/usr/share/pixmaps|${prefix}/share/pixmaps|" \
        ${mainapp}
}

destroot.destdir    --prefix=${destroot}${prefix}

post-destroot {
    xinstall -d ${destroot}${python.prefix}
    file rename ${destroot}${prefix}/lib ${destroot}${python.prefix}
}

notes "Read the Mac OS tips from Dan's web site at http://chirp.danplanet.com/projects/chirp/wiki/MacOS_Tips. The Application Security section can be skipped since we are running a wrapper app."
