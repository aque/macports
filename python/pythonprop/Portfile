# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           app 1.0

name                pythonprop
categories          python science
platforms           darwin
license             GPL-3
maintainers         gmail.com:allan.que openmaintainer
description         python scripts designed to work with voacap to model radio \
                    propagation
long_description    ${name} is a collection of Python scripts designed to work \
                    with VOACAP, allowing users to create input files using a Graphical \
                    User Interface and plot output files used for modeling radio \
                    propagation to predict point-to-point path loss and coverage.
homepage            http://www.qsl.net/h/hz1jw/pythonprop

version             0.22
revision            0
conflicts           ${name}-devel

app.name            PythonProp
app.executable      ${filespath}/wrapper.sh
app.icon            src/${name}/ui/voacap.png
app.identifier      net.hz1jw.pythonprop

variant python34 conflicts python35 description {Use python 3.4} {}

variant python35 conflicts python34 description {Use python 3.5} {}

if {![variant_isset python34] && ![variant_isset python35]} {
    default_variants-append +python34
}

if {[variant_isset python34]} {
    set python.version  34
    set python.branch   3.4
} elseif {[variant_isset python35]} {
    set python.version  35
    set python.branch   3.5
}

checksums           rmd160  c83323c27f04d6a8b5760cc3b1fb8d77a6f5be2f \
                    sha256  cd06c766deee73fa0a4817b3868d029daa2ac486eabc926fb9b9d7a79214fbf5

depends_build       port:gnome-doc-utils

depends_lib         port:py${python.version}-pip \
                    port:py${python.version}-matplotlib-basemap \
                    port:py${python.version}-gobject3 \
                    port:py${python.version}-cairocffi

depends_run         port:adwaita-icon-theme \
                    port:gnome-themes-standard \
                    port:yelp \
                    port:voacapl

configure.env-append    PYTHON="${prefix}/bin/python${python.branch}"
build.target        {}

subport ${name}-devel {
    PortGroup           github 1.0
    github.setup        jawatson pythonprop 4fca8189ed6cbf756fabfe2bb5a2df3fbbefe450
    version             20170622
    conflicts           ${name}

    variant builddoc description {Build the .pdf doc - requires dblatex} {
        depends_build-append    port:dblatex
    }

    checksums           rmd160  02733fa81b85f126e68961e2788278c356e4ca23 \
                        sha256  36a53815eb35ec44c154337d6fc72cca2452f5bf21ff24670ab00fddd4430419

    use_autoconf        yes
    autoconf.cmd        ${worksrcpath}/autogen.sh
}

if {${name} eq ${subport}} {
    master_sites        http://www.qsl.net/hz1jw/pythonprop/downloads
    patchfiles          patch-voaP2PPlot.py
}

post-patch {
    if {${name} ne ${subport} && ![variant_isset builddoc]} {
        # comment out pdf document building in Makefile.am
        reinplace -W ${worksrcpath}/docs/user/help "s+^pdf_DATA+#pdf_DATA+g" Makefile.am
        reinplace -W ${worksrcpath}/docs/user/help "s+^voacapgui.pdf:+#voacapgui.pdf:+g" Makefile.am
        reinplace -W ${worksrcpath}/docs/user/help "s+^	dblatex C+#	dblatex C+g" Makefile.am
    }
}

post-destroot {
    foreach f [glob -directory ${destroot}${prefix}/bin *] {
        reinplace "s+env python3+env python${python.branch}+g" ${f}
    }
}

post-activate {
    catch {system "${prefix}/bin/scrollkeeper-update"}
    catch {system "${prefix}/bin/update-desktop-database ${prefix}/share/applications"}
    catch {system "${prefix}/bin/gtk-update-icon-cache -f -t ${prefix}/share/icons/hicolor"}
    catch {system "${prefix}/bin/glib-compile-schemas ${prefix}/share/glib-2.0/schemas"}
}

notes "Run \'makeitshfbc\' from the voacapl port to create the ~/itshfbc directory structure."
