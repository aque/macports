# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           compilers 1.0
PortGroup           app 1.0

name                fldigi
categories          comms
platforms           darwin
license             GPL-3+
maintainers         gmail.com:allan.que openmaintainer
description         Amateur radio modem program
long_description    ${name} (Fast Light Digital Modem Application) is a cross-platform \
                    modem program that supports most of the digital modes used \
                    on the amateur radio bands.
version             3.23.12
homepage            http://www.w1hkj.com
master_sites        sourceforge:project/fldigi/${name}

checksums           rmd160  256a177701ab8c45365e57ec24f600c6d79d2175 \
                    sha256  59ba6ad8304849cb92b3ec2251bd389f4dfa7755de07a4d1638f71b17c0b3cce

depends_build-append \
                    port:pkgconfig \
                    port:libpng \
                    port:fltk \
                    port:portaudio \
                    port:libsamplerate \
                    port:libsndfile \
                    port:xmlrpc-c \
                    port:libtool \
                    port:asciidoc

compilers.choose    cc cxx
compilers.setup     -clang -llvm -dragonegg

default_variants    +gcc49
universal_variant   no

test.run            yes
test.target         check

app.icon            data/mac/${name}.icns

# enabling hamlib results in a compile error
configure.post_args \
                    --enable-static \
                    --enable-optimizations=sse2 \
                    --disable-mac-universal \
                    --without-hamlib


post-configure {
    # remove clang specific option in Makefile
    reinplace "s|-stdlib=libc++||g" src/Makefile doc/Makefile
}

patch {
    # delete placeholder files that asciidoc creates
    file delete ${worksrcpath}/doc/fldigi.1
    file delete ${worksrcpath}/doc/flarq.1
}

livecheck.regex     ${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}
livecheck.type      sourceforge

